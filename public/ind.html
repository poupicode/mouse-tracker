<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Suivi de souris</title>
    <script src="https://cdn.socket.io/4.0.1/socket.io.min.js"></script>
    <style>
        * { cursor: none !important; }
        body { 
            margin: 0; 
            overflow: hidden; 
            font-family: sans-serif;
            background-color: rgb(97, 97, 164);
        }

        .cursor {
            position: absolute;
            width: 32px;
            height: 48px;
            pointer-events: none;
            z-index: 2;
        }

        .name-tag {
            position: absolute;
            font-size: 12px;
            background: rgba(255,255,255,0.8);
            padding: 2px 6px;
            border-radius: 4px;
            white-space: nowrap;
            pointer-events: none;
            z-index: 1;
        }

        #userList {
            position: fixed;
            top: 10px;
            left: 10px;
            background: white;
            padding: 10px;
            border-radius: 8px;
            z-index: 999;
            font-size: 14px;
        }

        #userList ul {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        #titleBanner {
            position: fixed;
            top: 5vh;
            left: 50%;
            transform: translateX(-50%);
            font-size: 6vw; /* Responsive text size */
            font-weight: bold;
            color: white;
            text-shadow: 3px 3px 10px rgba(0, 0, 0, 0.6);
            z-index: 1000;
            font-family: 'Arial Black', sans-serif;
            text-align: center;
            white-space: nowrap;
            pointer-events: none;
        }


        @media (max-width: 600px) {
            #titleBanner {
                font-size: 9vw;
            }
        }

        @media (min-width: 1200px) {
            #titleBanner {
                font-size: 48px;
            }
        }

    </style>
</head>
<body>

<div id="userList">
    <strong>Connect√©s :</strong>
    <ul id="users"></ul>
</div>

<div id="titleBanner">CURSOR PARC</div>

<script>
    const socket = io('http://localhost:3000'); // √† adapter pour ton render prod

    // üîÅ R√©cup√®re nom & couleur localement
    let userColor = localStorage.getItem('userColor') || '';
    let userName = localStorage.getItem('userName') || '';

    // ‚õîÔ∏è Si aucun nom, demander une fois puis le stocker
    if (!userName) {
        userName = prompt("Quel est ton nom ?") || "Anonyme";
        userName = userName.trim().slice(0, 20);
        localStorage.setItem('userName', userName);
    }

    // üîÅ Restaurer la couleur pr√©c√©dente si dispo
    if (userColor) {
        socket.emit('restore_color', userColor);
    }

    // üëã Envoyer le nom au serveur
    socket.emit('set_name', userName);

    // üî¥ Ton curseur perso
    const userCursor = document.createElement("img");
    userCursor.style.position = "absolute";
    userCursor.style.width = "32px";
    userCursor.style.height = "48px";
    userCursor.style.zIndex = "2";
    userCursor.style.pointerEvents = "none";
    document.body.appendChild(userCursor);

    // üßæ Nom en dessous du curseur
    const myTag = document.createElement("div");
    myTag.className = "name-tag";
    myTag.innerText = userName;
    document.body.appendChild(myTag);

    // üéØ Suivi souris
    document.addEventListener('mousemove', (event) => {
        if (!userColor) return;

        const x = event.clientX;
        const y = event.clientY;

        userCursor.style.left = `${x - 3}px`;
        userCursor.style.top = `${y - 4}px`;

        myTag.style.left = `${x + 20}px`;
        myTag.style.top = `${y + 45}px`; // üëâ en dessous
        socket.emit('mouse_move', { x, y });
    });

    socket.on('user_color', (color) => {
        userColor = color;
        localStorage.setItem('userColor', color);
        userCursor.src = `images/${color}-cursor.png`;
    });

    // üéØ Autres utilisateurs
    const cursors = {}; // { socketId: { cursor, nameTag } }

    socket.on('mouse_move', (data) => {
        if (data.id === socket.id) return;

        if (!cursors[data.id]) {
            const cursor = document.createElement("img");
            cursor.className = "cursor";
            cursor.src = `images/${data.color}-cursor.png`;
            document.body.appendChild(cursor);

            const nameTag = document.createElement("div");
            nameTag.className = "name-tag";
            nameTag.innerText = data.name || 'Anonyme';
            document.body.appendChild(nameTag);

            cursors[data.id] = { cursor, nameTag };
        }

        const { cursor, nameTag } = cursors[data.id];
        cursor.style.left = `${data.x - 3}px`;
        cursor.style.top = `${data.y - 4}px`;
        nameTag.style.left = `${data.x + 20}px`;
        nameTag.style.top = `${data.y + 45}px`; // üëâ dessous
    });

    // üßë‚Äçü§ù‚Äçüßë Liste utilisateurs
    socket.on('update_users', (userList) => {
        const ul = document.getElementById('users');
        ul.innerHTML = '';
        userList.forEach(user => {
            const li = document.createElement('li');
            li.innerText = user.name || 'Anonyme';
            li.style.color = user.color;
            if (user.id === socket.id) li.style.fontWeight = 'bold';
            ul.appendChild(li);
        });
    });

    socket.on('error', (msg) => alert(msg));
</script>
</body>
</html>